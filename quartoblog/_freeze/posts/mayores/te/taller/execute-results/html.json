{
  "hash": "d16402abece3b88366d6722826bdc8c5",
  "result": {
    "markdown": "---\ntitle: \"Taller abierto\"\nauthor: \"Pedro Orden\"\ndate: \"16/9/2022\"\noutput:\n  html_document:\n    toc: true\n    toc_float: true\n    code_download: true\n    code_folding: hide\n    theme: simplex\n---\n\n\n\n\n## Marco\n\nEl [taller abierto](https://www.canva.com/design/DAFLyN2w-ew/jJz7cs6igww-igO2nVoCeA/view) es un espacio de encuentro para conocer y utilizar entre todos y todas herramientas de valor profesional para la ciencias sociales, son llevados adelante por el [Núcleo de Innovación Social](https://www.nucleodeinnovacion.com/), con el aval del [Colegio de Sociólogos y Sociólogas de la Provincia de Buenos Aires (Ley 10.307)](http://cspba.org.ar/), el [Consejo de Profesionales en Sociología (Ley 23.553)](http://cps.org.ar/) y la [Asociación de Sociólogos de la República Argentina](https://www.facebook.com/sociologos.argentinos.ASRA).\n\n## Presentación\n\nEl presente documento es un material de taller pensado para profesionales de las ciencias sociales y público interesado. Procuraremos aquí presentar de manera general una serie de procedimientos asociados al procesamiento de encuestas con R.\n\nVeremos aquí:\n\n-   Carga de datos de un formulario drive y transformación.\n\n-   Análisis preliminar/exploratorio.\n\n-   Visualización.\n\n-   Recomendaciones profesionales: [visual mode](https://www.rstudio.com/blog/exploring-rstudio-visual-markdown-editor/) ([ahora mismo]{.ul}), [skimr](https://docs.ropensci.org/skimr/), [esquisser](https://dreamrs.github.io/esquisse/) y [janitor](http://sfirke.github.io/janitor/).\n\n## Carga de datos\n\nLos datos de trabajo pertenecen a una sub-muestra de una encuesta realizada por los [Colegios Profesionales de Buenos Aires y el NIS](https://clip-urbano.com/2020/04/05/el-colegio-de-sociologos-invita-a-participar-de-una-encuesta-sobre-medios-e-informacion-en-tiempos-de-pandemia/) a comienzos de la pandemia, los mismos son 100% anónimos y fueron recabados por medio de un formulario Google.\n\nComenzamos cargando en R las respuestas de **drive** (previamente debemos compartirlo como público en la web, en formato *csv*) y creamos el objeto *muestra1*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmuestra1<-read.csv(\"https://docs.google.com/spreadsheets/d/e/2PACX-1vTbdWYdjYhfvt8quj9A5LpIEhH-sSKwxTsG8lKLLK_E_C5r1tkqFNdQNSAdzXvgthWCrFDn7oiN3-9P/pub?gid=346447959&single=true&output=csv\",encoding = \"UTF-8\")\n```\n:::\n\n\nExploramos con **funciones base** de R nuestros datos (todavía no estamos usando paquetes).\n\nIndagamos acerca de la clase de nuestros datos:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nclass(muestra1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"data.frame\"\n```\n:::\n:::\n\n\nConsultamos la dimensión del conjunto de datos, filas y columnas:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndim(muestra1)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 627  24\n```\n:::\n:::\n\n\nY podríamos seguir así, pero no, cargamos el *(muy genial)* paquete [skimr](https://docs.ropensci.org/skimr/) el cual nos ayudará a crear un primer **resumen** de las características de nuestro set de datos (tengamos presente que para correr un paquete primero hay que instalarlo).\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"skimr\") #lo grisado no se ejecuta\nlibrary(skimr)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'skimr' was built under R version 4.1.3\n```\n:::\n\n```{.r .cell-code}\nskim(muestra1)\n```\n\n::: {.cell-output-display}\nTable: Data summary\n\n|                         |         |\n|:------------------------|:--------|\n|Name                     |muestra1 |\n|Number of rows           |627      |\n|Number of columns        |24       |\n|_______________________  |         |\n|Column type frequency:   |         |\n|character                |19       |\n|numeric                  |5        |\n|________________________ |         |\n|Group variables          |None     |\n\n\n**Variable type: character**\n\n|skim_variable                                                                                                                                | n_missing| complete_rate| min| max| empty| n_unique| whitespace|\n|:--------------------------------------------------------------------------------------------------------------------------------------------|---------:|-------------:|---:|---:|-----:|--------:|----------:|\n|Marca.temporal                                                                                                                               |         0|             1|  17|  19|     0|      622|          0|\n|X.Estás.haciendo.cuarentena.                                                                                                                 |         0|             1|   2|   2|     0|        2|          0|\n|Te.identificas.como.                                                                                                                         |         0|             1|   0|   6|     9|        3|          0|\n|X.En.qué.provincia.vivís.actualmente.                                                                                                        |         0|             1|   0|  31|     9|       18|          0|\n|X.Cuál.es.el.máximo.nivel.educativo.que.completaste.                                                                                         |         0|             1|   0|  36|     9|        9|          0|\n|X.Cuál.es.tu.principal.ocupación.                                                                                                            |         0|             1|   0| 156|     9|       11|          0|\n|X.Estas.trabajando.desde.tu.casa.bajo.alguna.modalidad.de.tele.trabajo..home.office..                                                        |         0|             1|   0|  29|   119|        4|          0|\n|X.Tenes.hijos.en.edad.escolar.                                                                                                               |         0|             1|   0|  49|     9|        5|          0|\n|X.Estás.viviendo.con.ellos.durante.esta.cuarentena.                                                                                          |         0|             1|   0|  68|   310|        4|          0|\n|De.la.siguiente.lista..Cuáles.son.tus.tres.principales.medios.para.informarte.sobre.los.asuntos.del.país.y.la.circunstancia.del.coronavirus. |         0|             1|   0| 151|     9|      246|          0|\n|X.Te.gustaría.nombrar.algún.otro.medio.que.estés.usando.                                                                                     |         0|             1|   0| 125|   224|      119|          0|\n|X.Cambiaste.la.forma.en.que.te.informas.desde.que.comenzó.la.cuarentena.                                                                     |         0|             1|   0|   2|     9|        3|          0|\n|X.Cómo.cambió.la.forma.en.que.te.informaste                                                                                                  |         0|             1|   0| 626|   426|      201|          0|\n|X.Recibiste.noticias..información.relacionada.al.coronavirus.y.o.la.cuarentena.que.resultaron.ser.falsas.                                    |         0|             1|   0|   5|     9|        4|          0|\n|X.Recordas.a.través.de.qué.medio.recibiste.esa.información.falsa.                                                                            |         0|             1|   0| 152|   159|      103|          0|\n|X.Crees.que.las.noticias.falsas.o.fake.news.están.influyendo.en.el.comportamiento.de.las.personas.                                           |         0|             1|   0|   5|     9|        4|          0|\n|X.Cómo.crees.que.influyen.las.noticias.falsas.o.fake.news.están.influyendo.en.el.comportamiento.de.las.personas.                             |         0|             1|   0| 909|   212|      400|          0|\n|X.Cuál.es.la.ocupación.de.la.persona.que.realiza.el.principal.aporte.económico.                                                              |         0|             1|   0| 167|     9|       11|          0|\n|Ante.una.emergencia.médica..problema.de.salud..a.dónde.acudis.primero.                                                                       |         0|             1|   0| 116|    12|       20|          0|\n\n\n**Variable type: numeric**\n\n|skim_variable                                                                                               | n_missing| complete_rate|  mean|    sd| p0| p25| p50| p75| p100|hist                                     |\n|:-----------------------------------------------------------------------------------------------------------|---------:|-------------:|-----:|-----:|--:|---:|---:|---:|----:|:----------------------------------------|\n|X.Cuántos.años.tenés.                                                                                       |         9|          0.99| 42.48| 13.65| 18|  32|  40|  53|   82|▅▇▅▃▁ |\n|X.En.qué.medida.te.sentís.informado.a.acerca.de.las.medidas.de.prevención.del.Coronavirus.                  |         9|          0.99|  4.28|  0.79|  1|   4|   4|   5|    5|▁▁▂▆▇ |\n|X.Cuál.es.tu.opinión.acerca.de.lo.que.comunican.los.medios.de.comunicación.argentinos.sobre.el.Coronavirus. |         9|          0.99|  3.34|  0.89|  1|   3|   3|   4|    5|▁▂▇▆▂ |\n|X.Cuántas.personas.viven.en.tu.hogar.incluyéndote.a.vos.                                                    |         9|          0.99|  3.54| 20.97|  0|   2|   2|   4|  522|▇▁▁▁▁ |\n|X.y.cuántas.realizan.algún.tipo.de.aporte.económico.                                                        |         9|          0.99|  1.78|  0.81|  0|   1|   2|   2|    5|▆▇▂▁▁ |\n:::\n:::\n\n\nUn resumen de nuestros datos con dos líneas de código, genial no? Este tipo de paquetes y funciones caracterizan a R, existen muchos desarrollos de la [comunidad](https://community.rstudio.com/) que pueden ayudarnos en nuestra labor diaria. Lo [importante]{.ul} es conocerlos y contar con el criterio de saber en qué momento y cómo usarlos.\n\n## Limpieza de datos\n\nComo hemos visto, tenemos una muestra de respondentes y la propuesta es ahora presentar algunos cálculos de estadística descriptiva y generar visualizaciones, ya que una parte importante de nuestro trabajo con encuestas tiene que ver con armar gráficos que reflejen el comportamiento de variables.\n\nAhora bien, antes de avanzar precisamos hacerle algunos ajustes a nuestros datos.\n\nPara llevar adelante este proceso vamos a cargar dos paquetes muy útiles para transformar datos -[tidyverse](https://www.tidyverse.org/)- ly normalizar las fechas -[lubridate](https://lubridate.tidyverse.org/)-.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"tidyverse\")\nlibrary(tidyverse)\n#install.packages(\"lubridate\")\nlibrary(lubridate)\n```\n:::\n\n\nCreamos el objeto muestra2, son nuestros datos de partida con *fechas* normalizadas y *espacios* en blanco reemplazados por NAs (mejora el procesamiento). Lo hacemos mediante las siguientes transformaciones:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmuestra2<-muestra1%>% #pipe de tidyverse\n  mutate(Marca.temporal=sub(\" .*\", \"\", Marca.temporal))%>%\n  #transformamos nuestros datos\n  mutate(Marca.temporal=dmy(Marca.temporal))%>% #formateamos fecha\n  mutate_if(is.character, list(~na_if(.,\"\")))\n```\n:::\n\n\n## Primeras preguntas\n\nDado el ajuste rápido de nuestros datos, queremos conocer más sobre el proceso de campo del formulario, por ejemplo: entre qué fechas tuvo lugar y cuántos respondentes tuvo por día?\n\nVeamos qué podemos decir con nuestro objeto muestra2:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrespuestas <- muestra2%>%\n  group_by(Marca.temporal)%>% #agrupamos por fecha\n  count() #contamos respuestas por fecha\n\nrespuestas\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n# A tibble: 25 x 2\n# Groups:   Marca.temporal [25]\n   Marca.temporal     n\n   <date>         <int>\n 1 2020-03-31         2\n 2 2020-04-06       367\n 3 2020-04-07       116\n 4 2020-04-08        50\n 5 2020-04-09        23\n 6 2020-04-10        27\n 7 2020-04-11         5\n 8 2020-04-12         2\n 9 2020-04-13         4\n10 2020-04-14         3\n# ... with 15 more rows\n```\n:::\n:::\n\n\nGraficamos las respuestas por día con [ggplot2](https://ggplot2.tidyverse.org/), una librería R que sirve para hacer gráficos. Viene con el paquete tidyverse que ya tenemos activado.\n\nVeamos como opera la lógica de estos gráficos en la práctica:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrespuestas%>% #nuestro objeto\n  ggplot() + #declara la funcion para graficar el objeto\n  aes(x = Marca.temporal, y = n) + #idicamos las variables a graficar\n  geom_line(size = 0.5) #una geometria que la exprese, en este caso es una linea\n```\n\n::: {.cell-output-display}\n![](taller_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\nVemos que el momento de nuestro campo tuvo un período de actividad desde finales de marzo y durante todo abril, luego registró respuestas esporádicas (por error).\n\nRepitamos el ejercicio poniendo nuestra atención en el lapso temporal en el que se registró la mayor cantidad de respuestas basándonos en la referencia visual que creamos.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrespuestas%>%\n  filter(!Marca.temporal>=\"2020-05-01\")%>% #excluimos mayo 2020 en adelante\n  ggplot() + #declara la funcion para graficar el objeto\n  aes(x = Marca.temporal, y = n) + #una geometria que la exprese, en este caso es una linea\n  geom_line(size = 0.9) #aumentamos la linea\n```\n\n::: {.cell-output-display}\n![](taller_files/figure-html/unnamed-chunk-9-1.png){width=672}\n:::\n:::\n\n\nPresentamos ahora una tecnología *facilitadora* del proceso que acabamos de realizar.\n\n## Gráficos con la librería Esquisse\n\nAntes de contarles qué hace, veamos cómo funciona:\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"esquisse\")\nlibrary(esquisse)\n# grisamos nuestro codigo como un machete.\n# lo a ctivamos para consulta \n# respuestas%>%\n#   esquisser()\n```\n:::\n\n\n[**Esquisse**](https://cran.r-project.org/web/packages/esquisse/vignettes/get-started.html) ayuda a explorar y visualizar nuestros datos de forma interactiva. El paquete crea gráficos ggplot de manera ágil por medio de una interfaz basada en arrastrar, soltar y filtrar para luego exportar los resultados como .png, .jpg o recuperar el código.\n\nPlantea dos utilidades principales:\n\n1.  **EDA al instante**: aunque ggplot es muy rápido y fácil de usar, esquisse permite explorar visualmente los datos en todos los ángulos con una variedad de tipos de gráficos, filtros, agrupaciones, etc.\n\n2.  **Conocer ggplot** : con este paquete se puede crear rápidamente un gráfico, mirar el código, hacer un cambio, ver cómo eso impactó en el código y repetir.\n\nComo se distribuye la variable edad de nuestra muestra? lo exploramos con esquisse.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# muestra2%>%\n#   esquisser()\n\n# Cod: ejemplo\n  ggplot(muestra2) +\n  aes(x = X.Cuántos.años.tenés.) +\n  geom_histogram(bins = 10L, fill = \"#46337E\") +\n  labs(\n    x = \"años\",\n    y = \"n respondentes\",\n    title = \"Distribucion de la variable edad\",\n    subtitle = \"datos de muestra\"\n  ) +\n  theme_light()\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: Removed 9 rows containing non-finite values (stat_bin).\n```\n:::\n\n::: {.cell-output-display}\n![](taller_files/figure-html/unnamed-chunk-11-1.png){width=672}\n:::\n:::\n\n\n## Calculemos porcentuales\n\nEl paquete [janitor](http://sfirke.github.io/janitor/) es otro aliado imprescindible ya que suma una una gama extra de funcionalidades a la hora de limpiar datos, entre las más destacables: genera nombres de columnas legibles, elimina columnas y filas vacías y encuentra valores duplicados. Aquí la usaremos para un proceso muy específico que es la creación de tablas de frecuencias y porcentuales.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n#install.packages(\"janitor\")\nlibrary(janitor)\n\ncuarentena<-muestra2%>%\n    tabyl(X.Estás.haciendo.cuarentena.)\n\nprint(cuarentena)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n X.Estás.haciendo.cuarentena.   n    percent\n                           No   9 0.01435407\n                           Sí 618 0.98564593\n```\n:::\n:::\n\n\nEl recorte de nuestra muestra indica que casi el 99% estaba haciendo cuarentena al momento de responder el formulario.\n\nCrucemos ahora estos datos con la variable de tenencia de hijos en edad escolar, para crear una tabla de doble entrada.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncruce <- muestra2 %>%\n  rename(hace_home=X.Estas.trabajando.desde.tu.casa.bajo.alguna.modalidad.de.tele.trabajo..home.office..)%>%\n  tabyl(X.Tenes.hijos.en.edad.escolar., \n        hace_home,\n        show_na = FALSE)%>%\n  adorn_percentages(\"row\")\n\ncruce\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                    X.Tenes.hijos.en.edad.escolar.        No        Sí\n                                No, no tengo hijos 0.2154472 0.7276423\n                   Sí, tengo hijos en edad escolar 0.2352941 0.6993464\n Sí, tengo hijos pero aún no están en edad escolar 0.3000000 0.7000000\n    Sí, tengo hijos pero ya no tienen edad escolar 0.2323232 0.7373737\n Siempre trabajo desde mi casa\n                    0.05691057\n                    0.06535948\n                    0.00000000\n                    0.03030303\n```\n:::\n\n```{.r .cell-code}\n# y si lo esquisiamos (?\n# cruce%>%\n#   esquisser() #que pasa?\n```\n:::\n\n\nAsi como los estamos exportando no podemos graficarlos con ggplot ya que se multiplican las columnas con información. Para evitar que esto pase, un procedimiento habitual es volver a transformar nuestros datos en un par clave-valor.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncruce2 <- cruce%>%\n  gather('hace_home', 'pct', c(2:4))%>% #reune varias columnas para convertirlas en un par clave-valor\n  mutate(pct=round(pct*100, 1))# formateamos porcentaje\n\nhead(cruce2)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n                     X.Tenes.hijos.en.edad.escolar. hace_home  pct\n1                                No, no tengo hijos        No 21.5\n2                   Sí, tengo hijos en edad escolar        No 23.5\n3 Sí, tengo hijos pero aún no están en edad escolar        No 30.0\n4    Sí, tengo hijos pero ya no tienen edad escolar        No 23.2\n5                                No, no tengo hijos        Sí 72.8\n6                   Sí, tengo hijos en edad escolar        Sí 69.9\n```\n:::\n\n```{.r .cell-code}\n#checkeamos\n# cruce2%>%\n#   esquisser()\n```\n:::\n\n\nCon nuestro datos transformados podríamos generar un gráfico de base similar a este:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(cruce2) +\n aes(x = X.Tenes.hijos.en.edad.escolar., y = pct, fill = hace_home) +\n geom_col() +\n scale_fill_hue(direction = 1) +\n  theme(axis.text.x = element_text(angle = 45))\n```\n\n::: {.cell-output-display}\n![](taller_files/figure-html/unnamed-chunk-15-1.png){width=672}\n:::\n:::\n\n\n## Procesando variable de escala Likert\n\nO casi. Transformamos la pregunta: *en qué medida te sentís informado a acerca de las medidas de prevención del Coronavirus*, con una escala de 1 a 5, donde 1 es *nada informado/a* y 5 es *muy informado/a*.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmuestra3<-muestra1%>%\n  rename(informa=X.En.qué.medida.te.sentís.informado.a.acerca.de.las.medidas.de.prevención.del.Coronavirus.)%>%\n  tabyl(informa, \n        show_na = FALSE)\n\nmuestra3<-muestra3%>%\n  mutate(percent=round(percent*100,1))%>%\n  mutate(informa=case_when(informa==1~\"1 nada informado/a\",\n                           informa==2~\"2 un poco informado/a\",\n                           informa==3~\"3 informado/a\",\n                           informa==4~\"4 bastante informado/a\",\n                           informa==5~\"5 muy informado/a\"))%>%\n  mutate(informa=as.factor(informa))\n\n#repetimos el esquisseo (??\n# muestra3%>%\n#   esquisser()\n```\n:::\n\n\n## Ejemplo: monitor socioeconómico\n\nEs un [tablero](https://pedroorden.shinyapps.io/socio-economico/) creado completamente en R que extrae los microdatos de la Encuesta Permanente de Hogares (INDEC), los procesa y visualiza de manera dinámica para conocer más sobre la coyuntura e historia reciente del mercado de trabajo y condiciones de vida en Argentina.\n\nSe trata de un proyecto en progreso del **NIS** que da cuenta de cómo podemos usar las nuevas herramientas de análisis y programación para automatizar y comunicar nuestro trabajo.\n\n## Bonus\n\nLa lógica de visualización no es solo para datos, ubicando puntos en los ejes **x** e **y** también podremos dibujar:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nseq(-2,2, by = 0.01) %>% \n  expand.grid(x=., y=.) %>% \n  ggplot(aes(x = x^3 - sin(y), y = y^3 - cos(x)))+\n  geom_point(alpha = 0.05, \n             color = \"#5E17EB\", shape = 20, size = 0)+ #https://www.color-hex.com/\n  theme_void()+\n  coord_polar()+\n  labs(subtitle = \"Llegamos al final del taller abierto, gracias por participar\")\n```\n\n::: {.cell-output-display}\n![](taller_files/figure-html/unnamed-chunk-17-1.png){width=672}\n:::\n:::\n\n\nHasta la próxima!\n",
    "supporting": [
      "taller_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": null
  }
}